<!DOCTYPE html>
<html lang="es">
<head>
  <!-- ... (head sin cambios) ... -->
</head>
<body>
  <main class="container">
    <!-- Sección Móviles -->
    <section class="products-section">
      <h2 class="section-title">Móviles</h2>
      <div class="products-grid" id="moviles"></div>
    </section>
    
    <!-- Sección Covers -->
    <section class="products-section">
      <h2 class="section-title">Covers</h2>
      <div class="products-grid" id="covers"></div>
    </section>
    
    <!-- Sección Accesorios -->
    <section class="products-section">
      <h2 class="section-title">Accesorios</h2>
      <div class="products-grid" id="accesorios"></div>
    </section>
  </main>
  
  <script>
    // Función para escapar HTML
    const escapeHtml = (str) => {
      if (!str) return '';
      return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    };

    // Cargar productos al iniciar
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const response = await fetch('/api/products');
        const products = await response.json();
        
        if (!Array.isArray(products)) {
          throw new Error('Error al cargar productos');
        }
        
        // Filtrar por categorías
        const moviles = products.filter(p => p.category === 'moviles');
        const covers = products.filter(p => p.category === 'covers');
        const accesorios = products.filter(p => p.category === 'accesorios');
        
        // Renderizar cada categoría
        renderCategory('moviles', moviles);
        renderCategory('covers', covers);
        renderCategory('accesorios', accesorios);
        
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('moviles').innerHTML = '<p>Error al cargar los productos</p>';
        document.getElementById('covers').innerHTML = '';
        document.getElementById('accesorios').innerHTML = '';
      }
      
      function renderCategory(categoryId, products) {
        const container = document.getElementById(categoryId);
        if (!container) return;
        
        if (products.length === 0) {
          container.innerHTML = `<p style="text-align:center;color:#b1ffdd">No hay productos en esta categoría</p>`;
          return;
        }
        
        container.innerHTML = products.map(product => `
          <div class="product-card">
            <div class="product-image" onclick="showImageModal('${escapeHtml(product.image)}')">
              <img src="${escapeHtml(product.image)}" alt="${escapeHtml(product.name)}" loading="lazy">
            </div>
            <div class="product-info">
              <div class="product-title">${escapeHtml(product.name)}</div>
              <div class="product-price">$${Number(product.price || 0).toFixed(2)}</div>
              <div class="quantity-controls">
                <button class="quantity-btn minus-btn">-</button>
                <input class="quantity-input" type="number" min="1" value="1">
                <button class="quantity-btn plus-btn">+</button>
              </div>
              <button class="add-to-cart-btn" data-id="${escapeHtml(product.id)}" data-name="${escapeHtml(product.name)}" data-price="${product.price}" data-image="${escapeHtml(product.image)}">
                <i class="fa fa-cart-plus"></i> Añadir al carrito
              </button>
            </div>
          </div>
        `).join('');
        
        // Event listeners
        container.querySelectorAll('.minus-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const input = e.target.nextElementSibling;
            let val = parseInt(input.value || '1', 10);
            input.value = Math.max(1, val - 1);
          });
        });
        
        container.querySelectorAll('.plus-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const input = e.target.previousElementSibling;
            let val = parseInt(input.value || '1', 10);
            input.value = val + 1;
          });
        });
        
        container.querySelectorAll('.add-to-cart-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const id = btn.dataset.id;
            const name = btn.dataset.name;
            const price = parseFloat(btn.dataset.price);
            const image = btn.dataset.image;
            const qtyInput = btn.parentElement.querySelector('.quantity-input');
            const qty = Math.max(1, parseInt(qtyInput.value || '1', 10));
            
            // Añadir al carrito (implementar esta función en app.js)
            if (window.addToCart) {
              window.addToCart({ id, name, price, image }, qty);
              
              // Feedback visual
              btn.classList.add('added');
              btn.innerHTML = '<i class="fa fa-check"></i> Añadido';
              setTimeout(() => {
                btn.classList.remove('added');
                btn.innerHTML = '<i class="fa fa-cart-plus"></i> Añadir al carrito';
                qtyInput.value = 1;
              }, 2000);
            }
          });
        });
      }
    });
  </script>
</body>
</html>